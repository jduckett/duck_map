# Duck Map Guide

## Overview
In simple terms, an XML Sitemap is a list of the pages on your website.  Sitemaps generated by this gem are accessible via HTTP using a url
defined in config/routes.rb.  The default sitemap can be found at: /sitemap.xml  Sitemap content is constructed based on standard Rails named routes
and the process of generating the content is very straightforward.

  - access a sitemap via a url such as: /sitemap.xml
  - get a list of named routes defined for the sitemap
  - generate URL nodes for each of the named routes.

That's it!!

## Sitemap Definitions

### Default Sitemap
Duck Map gem is designed as a Rails Engine.  As part of the gem loading process, a default sitemap is configured via a config/routes.rb file located within
the gem.  The default sitemap is named :sitemap, has a path of: /sitemap.xml and contains all of the routes defined by your app.  If no routes are defined,
sitemap will produce empty xml content.

    # the following example will produce a default sitemap and requires zero configuration.
    MyApp::Application.routes.draw do

      resources :trucks
      root :to => "home#index"

    end

contents of /sitemap.xml will look similar to the following:

    <url>
      <loc>http://localhost:3000/trucks.html</loc>
      <lastmod>2011-11-03T06:44:25+00:00</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.5</priority>
    </url>
    <url>
      <loc>http://localhost:3000/</loc>
      <lastmod>2011-11-03T06:44:25+00:00</lastmod>
      <changefreq>monthly</changefreq>
      <priority>0.5</priority>
    </url>

### Using Sitemap Block Statements
You can control the contents of your sitemap using block statements and route filters.  Sitemaps are defined in config/routes.rb by enclosing
named routes within a sitemap block.  The default sitemap is the equivalent of enclosing the entire contents of config/routes.rb in a sitemap block.
The following example redefines the default sitemap by wrapping a few routes in a sitemap block.  Notice that bikes is excluded from the default sitemap.

    MyApp::Application.routes.draw do

      # notice that bikes is not included in the default sitemap.
      resources :bikes

      # here we are wrapping a couple of routes for inclusion in the default sitemap.
      sitemap do
        resources :cars
        resources :trucks
        root :to => 'home#index'
      end

    end

contents of sitemap.xml will look similar to the following:

    <?xml version="1.0" encoding="UTF-8"?>
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
      <url>
        <loc>http://localhost:3000/cars.html</loc>
        <lastmod>2011-11-03T07:35:00+00:00</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.5</priority>
      </url>
      <url>
        <loc>http://localhost:3000/trucks.html</loc>
        <lastmod>2011-11-03T07:35:00+00:00</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.5</priority>
      </url>
      <url>
        <loc>http://localhost:3000/</loc>
        <lastmod>2011-11-03T07:35:00+00:00</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.5</priority>
      </url>
    </urlset>

### Simple Sitemap Block Rule

You can include as many sitemap blocks as you desire.  All sitemap blocks can point to the same sitemap name, multiple names, or any combination.
The following two blocks are equivalent.

    MyApp::Application.routes.draw do

      sitemap do
        resources :cars
        root :to => 'home#index'
      end

      sitemap :sitemap do
        resources :trucks
      end

    end

In fact, if you were to use the above block definitions it would produce a single sitemap containing cars, trucks, and the root url by simply merging
all of the definitions into one.  It doesn't matter how many times you define a sitemap block.  It will ALWAYS merges all routes into one sitemap definition.

The simple rule for using sitemap blocks is:

- If a sitemap block has been defined, include everything within the block.
- If no sitemap blocks have been defined, include everything in config/routes.rb.

In fact, the default sitemap is defined without a block and includes all routes in config/routes.rb.  However, if you redefine the default sitemap
using a block only those routes will be included.

### Defining Multiple Sitemaps
You can group routes into multiple sitemaps.  Simply pass a name to the sitemap block and a new sitemap route containing all of the routes you include
within the block will be included in the sitemap.  The following will produce three separate sitemaps.

    MyApp::Application.routes.draw do

      sitemap do
        root :to => 'home#index'
        resources :faqs
      end

      sitemap :electronics do
        resources :cameras
        resources :laptops
        resources :desktops
      end

      sitemap :tools do
        resources :hand_tools
        resources :power_tools
      end

    end

- default sitemap accessible at: http://localhost:3000/sitemap.xml
- electronics sitemap accessible at: http://localhost:3000/electronics.xml
- tools sitemap accessible at: http://localhost:3000/tools.xml

### Namespaces
Namespaces are supported for sitemaps.  Namespaces could be a great solution for logically grouping sitemaps for large sites. Sitemaps behave in the
same manner regardless of namespace.  The main difference is the path pointing to the actual sitemap content.  The following example defines
five sitemaps including the default.

    MyApp::Application.routes.draw do
      
      namespace :products do

        sitemap do                            # /products/sitemap.xml
          namespace :video do
            sitemap do                        # /products/video/sitemap.xml
              sitemap :bluray do              # /products/video/bluray.xml
                resources :blu_ray_players
              end
              
              resources :dvd_players
              resources :accessories
            end
          end

          namespace :audio do
            sitemap do                        # /products/audio/sitemap.xml
              resources :head_phones
              resources :speakers
              resources :accessories
            end
          end
          resources :papers
          resources :pencils
        end

      end

      root :to => 'home#index'                # included in the default sitemap: /sitemap.xml
      resources :faqs

    end

- Products sitemap includes paper and pencils.
  - Products/video includes dvd_players and accessories.
  - Products/video/bluray includes blu_ray_players.  Notice that the sitemap block includes the name: bluray.  If we would have excluded the name,
    the routes within the block would have simply been added to /products/video/sitemap.xml and /products/video/bluray.xml would never be defined.
  - Products/audio includes head_phones, speakers, and accessories.
- The default sitemap includes the root url and FAQs.

### Nested Resources

### Route Filters

## Logging
Duck Map keeps a detailed log during the generation of a sitemap.  Use this log to determine why a route is or is not being included in a siteamp.  The default
log level is :info.  Switch to :debug to see every step in the process.  The location of the log file is in the standard Rails log directory and the file is
named: duck_map.log.

## Generators

### duckmap:sitemaps
The following rails generator will display all of the sitemap routes defined in config/routes.rb

    rails g duckmap:sitemaps

    Sitemap routes
    route name                               controller_name#action_name
                                             path
    ---------------------------------------------------------------------------------------------------------------
    sitemap_sitemap                          sitemap#sitemap
                                            /sitemap.:format
### duckmap:static

### duckmap:sync
Sychronizing with .git and local files on disk.
You have the power to include any route within a sitemap.  There is no requirement to have a model associated with any given route.  In fact, you may have a route
with several actions that contain some type of content where it makes sense that the last time the actual view file for an action represents the actual
last modified date for that action.  There are two ways to synchronize last modified dates for an application.

    # via rails generator
    rails g duck_map:sync

    # via rails task
    rake duck_map:sync

The acutal timestamp values are stored in a locale at: config/locales/sitemap.yml  Below is sample content.

    --- 
    :sitemap: 
      home: 
        index: 10/24/2011 02:03:51

When a Rails app needs a lastmod for a controller it will look to this file as the source for static values.  Running the generator or rake task will populate this
file for you, however, you have the option of manually editing this file.  The synchronization process uses the values in this file when deciding which timestamp
to use as the last modified date for an actions view file.  The decision is very simple.  The synchronization process will grab the timestamp from the actual view file
for the action on local disk, grab the timestamp of the same view file from a .git repository, and grab the timestamp of the view file from config/locales/sitemap.yml,
then, it will compare all three values.  The value that is the latest date/time wins the fight and that value is stored for the action inside config/locales/sitemap.yml

It is up to you to decide when to run the synchronization process.  If you are using a .git repository, then, you would have to commit all of you files, run the
synchronization process, then, commit again.  It may be an option to run the synchronization process during some type of central deployment procedure or even run
it on the production server.

## Demo applications
You can find articles and demo apps at: http://jeffduckett.com/blogs.html

## Copyright
Copyright (c) 2011 Jeff Duckett. See license.txt for details.
