<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: DuckMap::Handlers::Index
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../DuckMap.html" title="DuckMap (module)">DuckMap</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Handlers.html" title="DuckMap::Handlers (module)">Handlers</a></span></span>
     &raquo; 
    <span class="title">Index</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: DuckMap::Handlers::Index
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1">ActiveSupport::Concern</dd>
      
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/duck_map/handlers/index.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>get default values and assign to local variable containing all values from
a single url node and meta tag values for the index action.  the local
variable is referred to as "values".</p>
<ul><li>
<p>user can override method and manipulate the default values...</p>
</li></ul>

<p>index action is called.</p>
<ul><li>
<p>uses existing values generated via the index method</p>
</li><li>
<p>gives the developer a chance to set instance values to handle special cases</p>
</li></ul>

<p>lastmod is obtained from locale and merged with "values". call
sitemap_capture_attributes on the controller to capture values of the
current state and merge them with "values".</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sitemap_edit-instance_method" title="#sitemap_edit (instance method)">- (Object) <strong>sitemap_edit</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sitemap_index-instance_method" title="#sitemap_index (instance method)">- (Object) <strong>sitemap_index</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sitemap_new-instance_method" title="#sitemap_new (instance method)">- (Object) <strong>sitemap_new</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="sitemap_edit-instance_method">
  
    - (<tt>Object</tt>) <strong>sitemap_edit</strong>(options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/duck_map/handlers/index.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sitemap_edit'>sitemap_edit</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sitemap_index-instance_method">
  
    - (<tt>Object</tt>) <strong>sitemap_index</strong>(options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/duck_map/handlers/index.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sitemap_index'>sitemap_index</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rows'>rows</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># always start off with default values from config, then, simply overwrite them as we progress.
</span>  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_sitemap_defaults'>sitemap_defaults</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='comment'># if the source is meta_data, that means the call to sitemap_index is the result of a user
</span>  <span class='comment'># requesting an index page.  Therefore, there would be no reason to call the index action, because,
</span>  <span class='comment'># it has already been called and any instance variable have been set.
</span>  <span class='comment'># Otherwise, if this is the result of a sitemap request, then, call the index action to simulate
</span>  <span class='comment'># as if it were a user making the request.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='symbol'>:sitemap</span>

    <span class='kw'>begin</span>

      <span class='id identifier rubyid_index'>index</span>

    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='comment'># expect this exception to occur EVERYTIME...
</span>    <span class='kw'>end</span>

  <span class='kw'>end</span>


  <span class='id identifier rubyid_lastmod'>lastmod</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_static_lastmod'>sitemap_static_lastmod</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:controller_name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:action_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_lastmod'>lastmod</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:lastmod</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_lastmod'>lastmod</span>
  <span class='kw'>end</span>

  <span class='comment'># first, capture the values from the controller.
</span>  <span class='id identifier rubyid_attributes'>attributes</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_stripped_attributes'>sitemap_stripped_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:action_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_capture_attributes'>sitemap_capture_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_attributes'>attributes</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_data_rows'>data_rows</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:handler</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:block</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_data_rows'>data_rows</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:handler</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:block</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:handler</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:model</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_data_rows'>data_rows</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:handler</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:model</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>

  <span class='kw'>else</span>

    <span class='comment'># capture values from the first available model unless disabled.
</span>    <span class='id identifier rubyid_model_object'>model_object</span> <span class='op'>=</span> <span class='id identifier rubyid_sitemap_first_model'>sitemap_first_model</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:handler</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_model_object'>model_object</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
      <span class='id identifier rubyid_model_attributes'>model_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_model_object'>model_object</span><span class='period'>.</span><span class='id identifier rubyid_is_sitemap_attributes_defined?'>is_sitemap_attributes_defined?</span>
        <span class='id identifier rubyid_model_attributes'>model_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_model_object'>model_object</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_stripped_attributes'>sitemap_stripped_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:action_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_model_object'>model_object</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_capture_attributes'>sitemap_capture_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_model_attributes'>model_attributes</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='comment'># data_rows may have changed from an Array to a model object.
</span>  <span class='comment'># Make data_rows an Array if it has been switched to an model object.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_data_rows'>data_rows</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data_rows'>data_rows</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_data_rows'>data_rows</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># only process the first row since we are processing the index action of the controller
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_data_rows'>data_rows</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_data_rows'>data_rows</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>

    <span class='id identifier rubyid_data_row'>data_row</span> <span class='op'>=</span> <span class='id identifier rubyid_data_rows'>data_rows</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='id identifier rubyid_model_attributes'>model_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_attributes'>attributes</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data_row'>data_row</span><span class='period'>.</span><span class='id identifier rubyid_is_sitemap_attributes_defined?'>is_sitemap_attributes_defined?</span>
      <span class='id identifier rubyid_model_attributes'>model_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_data_row'>data_row</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_stripped_attributes'>sitemap_stripped_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:action_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_data_row'>data_row</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_capture_attributes'>sitemap_capture_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_model_attributes'>model_attributes</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:canonical</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_route'>route</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='symbol'>:meta_data</span> <span class='op'>?</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_application'>application</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='period'>.</span><span class='id identifier rubyid_find_route_via_path'>find_route_via_path</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:route</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_url_options'>url_options</span> <span class='op'>=</span> <span class='id identifier rubyid_sitemap_url_options'>sitemap_url_options</span><span class='lparen'>(</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>

    <span class='comment'># forgive me father for I have hacked...
</span>    <span class='comment'># i'm really being lazy here, but, if the current route is
</span>    <span class='comment'># the root, then, reassign the url to eliminate ?format=html, etc.
</span>    <span class='comment'># from the url.
</span>    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_eql?'>eql?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_url_options'>url_options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:format</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:canonical</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_root_url'>root_url</span><span class='lparen'>(</span><span class='id identifier rubyid_url_options'>url_options</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:canonical</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>_url</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_url_options'>url_options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:loc</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:canonical</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:loc</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='lbracket'>[</span><span class='symbol'>:canonical</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_sitemap_meta_data'>sitemap_meta_data</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_rows'>rows</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sitemap_new-instance_method">
  
    - (<tt>Object</tt>) <strong>sitemap_new</strong>(options = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/duck_map/handlers/index.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sitemap_new'>sitemap_new</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Feb 20 06:55:14 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.9.3).
</div>

  </body>
</html>